---
title: "prepocess group Duct"
output: html_notebook
---



## Make a new folder to store all the compressed files in different folder
- Use function "list.file" to find all the compressed file in each foler
- Use function "list.copy" to copy-past them into the new folder
```{r}
setwd("/Users/margery/Desktop/DataMiner-main/")
dir.create("groupduct")
for (dirname in dir('countsdataDuct/')){  
  file <- list.files(paste0(getwd(),'/countsdataDuct/',dirname),pattern = '*.counts')  
  file.copy(paste0(getwd(),'/countsdataDuct/',dirname,'/',file),'groupduct')  
}
```


## To find the TCGA ID corresponding to the file name
```{r}
metadata <- jsonlite::fromJSON("metadata.cart.duct.json")
naid_df <- data.frame()
for (i in 1:nrow(metadata)){
  naid_df[i,1] <- metadata$file_name[i]
  naid_df[i,2] <- metadata$associated_entities[i][[1]]$entity_submitter_id
}
colnames(naid_df) <- c('filename','TCGA_id')
```



## Read the data in batch

Data has two columns, one column is ensemble ID, the other column is the counts of the corresponding gene
Create a large data box and turn the second column into a column each time it is read
```{r}
```


```{r}
test <- data.table::fread(paste0("groupduct//",naid_df$filename[2]))
expr_df <- data.frame(matrix(NA,nrow(test),nrow(naid_df)))

for (i in 1:nrow(naid_df)) {
  print(i)
  expr_df[,i]= data.table::fread(paste0('groupduct/',naid_df$filename[i]))[,2]
}

```




## Add column names and gene names to the data read in

Read any single file and merge its first column into the big dataframe as the gene name
```{r}
colnames(expr_df) <- naid_df$TCGA_id

gene_id <- data.table::fread(paste0('groupduct//',naid_df$filename[1]))$V1
expr_df <- cbind(gene_id=gene_id,expr_df)
```

Remove the last 5 lines and store data
```{r}
expr_df_bigroup <- expr_df[1:(nrow(expr_df)-5),]
save(expr_df_bigroup,file = "expr_df_Duct.Rdata")
```





# Remove the doc in ensemble ID
```{r}
library(tidyr)
expr_df_biggroup_nopint <- expr_df_bigroup %>%
  tidyr::separate(gene_id,into = c("gene_id"),sep = "\\.")
```

```{r}
save(expr_df_biggroup_nopint,file="expr_Duct_nopoint.Rdata")
```


