---
title: "prepocess group Duct36"
output: html_notebook
---



## Make a new folder to store all the compressed files in different folder
- Use function "list.file" to find all the compressed file in each foler
- Use function "list.copy" to copy-past them into the new folder
Folder `orginal_groupduct36` contains heseq counts file of shrinked group duct without chaning name
```{r}
setwd("/Users/margery/Desktop/DataMiner-main/")
dir.create("orginal_groupduct36")
for (dirname in dir('gdc_download_36Duct')){  
  file <- list.files(paste0(getwd(),'/gdc_download_36Duct/',dirname),pattern = '*.counts')  
  file.copy(paste0(getwd(),'/gdc_download_36Duct/',dirname,'/',file),'orginal_groupduct36')  
}
```

# Folder `groupduct36` has been moved to folder `510_Final_Project`


## To find the TCGA ID corresponding to the file name
```{r}
setwd("/users/margery/Desktop/510_Final_Project/data")
metadata <- jsonlite::fromJSON("metadata.cart.groupduct36.json")
naid_df <- data.frame()
for (i in 1:nrow(metadata)){
  naid_df[i,1] <- metadata$file_name[i]
  naid_df[i,2] <- metadata$associated_entities[i][[1]]$entity_submitter_id
}
colnames(naid_df) <- c('filename','TCGA_id')
```


```{r}
write.csv(naid_df, file="filename_TCGAID_groupduct36")
```

## Read the data in batch

Data has two columns, one column is ensemble ID, the other column is the counts of the corresponding gene
Create a large data box and turn the second column into a column each time it is read


```{r}
setwd("/users/margery/Desktop/510_Final_Project")
test <- data.table::fread(paste0("orginal_groupduct36/",naid_df$filename[2]))
expr_df <- data.frame(matrix(NA,nrow(test),nrow(naid_df)))

for (i in 1:nrow(naid_df)) {
  print(i)
  expr_df[,i]= data.table::fread(paste0('orginal_groupduct36/',naid_df$filename[i]))[,2]
}

```




## Add column names and gene names to the data read in

Read any single file and merge its first column into the big dataframe as the gene name
```{r}
colnames(expr_df) <- naid_df$TCGA_id

gene_id <- data.table::fread(paste0('orginal_groupduct36/',naid_df$filename[1]))$V1
expr_df <- cbind(gene_id=gene_id,expr_df)
```

Remove the last 5 lines and store data
```{r}
expr_df_duct36 <- expr_df[1:(nrow(expr_df)-5),]
save(expr_df_duct36,file = "expr_df_Duct36.Rdata")
```





# Remove the doc in ensemble ID
```{r}
library(tidyr)
expr_df_duct36_nopoint <- expr_df_duct36 %>%
  tidyr::separate(gene_id,into = c("gene_id"),sep = "\\.")
```

```{r}
save(expr_df_duct36_nopoint,file="expr_Duct36_nopoint.Rdata")
```


